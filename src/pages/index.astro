---
// src/pages/index.astro
import Layout from "../layouts/Layout.astro";

// ▼▼▼ 変更点：共通化したファイルから読み込む（Step 3） ▼▼▼
import { client } from "../lib/microcms";
import type { MicroCMSListResponse } from "../lib/microcms";

type News = {
	id: string;
	title: string;
	date: string;
	url?: string;
};

// ▼▼▼ 削除：ここで createClient する記述は不要になりました ▼▼▼
// const client = createClient({ ... });

const response = await client.get<MicroCMSListResponse<News>>({
	endpoint: "news",
	queries: { fields: ["id", "title", "date", "url"] },
});
---

<Layout title="MAIN">
	<div id="header-placeholder"></div>

	<div id="search-wrap">
		<div class="close-btn"><span></span><span></span></div>
		<div class="search-area">
			<form id="login_form">
				<input
					type="password"
					id="pass"
					placeholder="Enter Secret Code..."
					autocomplete="off"
				/>
			</form>
		</div>
	</div>

	<section id="vidual-area">
		<div id="slider-area" class="bgextend bgRLextendTrigger">
			<div class="bgappearTrigger">
				<div id="slider"></div>
			</div>
		</div>

		<h2>
			<span class="js_typing">Modern Folk Song Club</span><br /><span
				class="js_typing">Information</span
			>
		</h2>
		<dl>
			<dt>Follow Us</dt>
			<dd>
				<ul>
					<li>
						<a href="https://x.com/momotenguitar"
							><svg
								width="20"
								height="20"
								viewBox="0 0 1200 1227"
								fill="none"
								xmlns="http://www.w3.org/2000/svg"
								><path
									d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"
									fill="white"></path></svg
							></a
						>
					</li>
					<li>
						<a href="https://www.instagram.com/mfsc_modern/?hl=ja"
							><img
								src="/img/main/ico_insta.svg"
								alt="Instagram"
							/></a
						>
					</li>
				</ul>
			</dd>
		</dl>
		<div class="scrolldown1"><span>Scroll</span></div>
	</section>

	<main id="main-area">
		<canvas id="audioSpectrumCanvas"></canvas>
		<section id="service">
			<h2 class="js_typing">Main</h2>
			<p class="service-lead">
				<span class="bgextend bgRLextendTrigger">
					<span class="bgappearTrigger"
						>MFSCの活動状況を随時アップロードしていきますm(__)m</span
					>
				</span>
			</p>

			<a href="/freshman" class="btnlinestretches2">新入生の皆様へ</a>

			<div class="service-area">
				<section class="bgextend bgLRextendTrigger">
					<div class="bgappearTrigger">
						<header><h3>GALLERY</h3><p>活動記録</p></header>
						<p>
							これまでに活動してきたライブ写真等を掲載しています。
						</p>
						<a href="/gallery" class="btnlinestretches2">More</a>
					</div>
				</section>

				<section class="bgextend bgLRextendTrigger">
					<div class="bgappearTrigger">
						<header><h3>SCHEDULE</h3><p>年間行事予定</p></header>
						<p>
							学内・学外のライブ予定、過去の予定を掲載しています。
						</p>
						<a href="/schedule" class="btnlinestretches2">More</a>
					</div>
				</section>
				<div class="service-img-wrapper bgextend bgLRextendTrigger">
					<div class="bgappearTrigger">
						<div class="service-img"></div>
					</div>
				</div>
			</div>
		</section>

		<div class="news-img-wrapper bgextend bgRLextendTrigger">
			<div class="bgappearTrigger"><div class="news-img"></div></div>
		</div>

		<section id="news">
			<h2 class="js_typing">News</h2>
			<div class="tab-area bgextend bgLRextendTrigger">
				<div class="bgappearTrigger">
					<ul class="tab">
						<li class="active"><a href="#topics">Topics</a></li>
					</ul>
					<div class="tab-choice-area">
						<div id="topics" class="area is-active">
							<ul id="news-list">
								{
									response.contents.map((news) => (
										<li>
											<time datetime={news.date}>
												{new Date(news.date)
													.toLocaleDateString(
														"ja-JP",
														{
															year: "numeric",
															month: "2-digit",
															day: "2-digit",
														},
													)
													.replace(/\//g, ".")}
											</time>
											{news.url ? (
												<a
													href={news.url}
													target="_blank"
													rel="noopener noreferrer"
												>
													{news.title}
												</a>
											) : (
												<span>{news.title}</span>
											)}
										</li>
									))
								}
							</ul>
						</div>
					</div>
				</div>
			</div>
		</section>
		<section id="contact"></section>
	</main>

	<script>
		document.addEventListener("DOMContentLoaded", () => {
			const form = document.getElementById("login_form");
			const passInput = document.getElementById("pass"); // type="password"

			if (form && passInput) {
				// エンターキーでの送信を防ぐ
				form.addEventListener("submit", (e) => {
					e.preventDefault();
					checkPassword();
				});

				// パスワードチェック関数
				function checkPassword() {
					// @ts-ignore
					const val = passInput.value;
					if (val === "888000") {
						// 一致したら limited ページへ
						window.location.href = "/limited";
					}
				}

				// キー入力検知
				passInput.addEventListener("keyup", function (event) {
					if (event.key === "Enter") {
						checkPassword();
					}
				});
			}
		});
	</script>

	<style>
		/* ニュースリストのスタイル（左揃え・縦積み完全修正版） */
		#news-list {
			padding: 0;
			list-style: none;
			text-align: left !important; /* 強制的に左揃え */
		}

		#news-list li {
			padding: 15px 0;
			border-bottom: 1px solid rgba(255, 255, 255, 0.1);

			/* ▼ 縦並び＆左寄せの設定 ▼ */
			display: flex;
			flex-direction: column; /* 縦積みにする */
			align-items: flex-start; /* 【重要】中身を左端に寄せる */
			justify-content: flex-start;
			gap: 5px; /* 日付とタイトルの隙間 */
		}

		#news-list time {
			font-size: 0.85rem;
			color: #aaa;
			font-family: "Oswald", sans-serif;
			letter-spacing: 0.05em;
			margin: 0; /* 変な余白を消す */
			line-height: 1;
		}

		#news-list a,
		#news-list span {
			font-size: 1rem;
			line-height: 1.5;
			display: block; /* ブロック要素にして横幅を確保 */
			text-decoration: none;
			text-align: left; /* 文字自体も左揃え */
			margin: 0; /* 変な余白を消す */
			padding: 0; /* 変な余白を消す */
			width: 100%; /* 横幅いっぱいに広げる */
		}

		#news-list a:hover {
			opacity: 0.7;
		}
	</style>
</Layout>
